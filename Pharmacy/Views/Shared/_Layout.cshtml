@inject Pharmacy.Data.ApplicationDbContext  context
@using Microsoft.EntityFrameworkCore;
@using Pharmacy.Data
@using System.Data.SqlClient

<!DOCTYPE html>

<html lang="en">

<!-- begin::Head -->
<head>
    <meta charset="utf-8" />
    <title>@ViewBag.Title | CMS</title>
    <meta name="description" content="Blank inner page examples">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">

    <!--begin::Web font -->
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
    <script>
        WebFont.load({
            google: { "families": ["Poppins:300,400,500,600,700", "Roboto:300,400,500,600,700"] },
            active: function () {
                sessionStorage.fonts = true;
            }
        });
    </script>

    <!--end::Web font -->
    <!--begin::Global Theme Styles -->
    @*<link href="~/demo11/assets/vendors/base/vendors.bundle.css" rel="stylesheet" type="text/css" />*@
    <link href="~/nprogress-master/nprogress.css" rel="stylesheet" type="text/css" />
    <link href="~/demo11/assets/vendors/base/vendors.bundle.rtl.css" rel="stylesheet" type="text/css" />
    @*<link href="~/demo11/assets/demo/demo11/base/style.bundle.css" rel="stylesheet" type="text/css" />*@

    <link href="~/demo11/assets/demo/demo11/base/style.bundle.rtl.css" rel="stylesheet" type="text/css" />

    <link rel="shortcut icon" href="~/Images/logo.png" />
    <link href="~/fonts/fonts.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Cairo" rel="stylesheet">

    <style>
        input, textarea, small, button, a, body {
            font-family: Cairo !important;
        }

        ::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
            font-family: Cairo !important;
        }

        .m-content {
            padding-top: 0px !important;
        }

        .m-portlet__body {
            padding-top: 0px !important;
        }

        .pagination {
            float: left !important;
        }

        .m-portlet__head-text {
            font-family: Cairo !important;
        }

        .modal-header {
            padding: 15px !important;
            background-color: #383656 !important;
        }

        .modal-body {
            padding: 10px !important;
        }

        .modal .modal-content .modal-header .modal-title {
            color: white;
        }

        .m-stack m-stack--ver m-stack--general m-stack--fluid {
            margin-right: 40px !important;
        }
    </style>
    @RenderSection("Css", false);
</head>

<!-- end::Head -->
<!-- begin::Body -->
<body class="m-content--skin- m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-light m-aside--offcanvas-default">

    <!-- begin:: Page -->
    <div class="m-grid m-grid--hor m-grid--root m-page">

        <!-- BEGIN: Header -->
        <header id="m_header" class="m-grid__item    m-header " m-minimize-offset="200" m-minimize-mobile-offset="200">
            <div class="m-container m-container--fluid m-container--full-height">
                <div class="m-stack m-stack--ver m-stack--desktop">

                    <!-- BEGIN: Brand -->
                    <div class="m-stack__item m-brand  m-brand--skin-light ">
                        <div class="m-stack m-stack--ver m-stack--general m-stack--fluid">
                            <div class="m-stack__item m-stack__item--middle m-brand__logo">
                                <a href="~/Meals" class="m-brand__logo-wrapper">
                                    <img alt="" src="~/Images/logo.png" width="63" height="60" />
                                </a>
                            </div>
                            <div class="m-stack__item m-stack__item--middle m-brand__tools">
                                <div class="m-dropdown m-dropdown--inline m-dropdown--arrow m-dropdown--align-left m-dropdown--align-push" m-dropdown-toggle="click" aria-expanded="true">
                                    <a href="#" class="dropdown-toggle m-dropdown__toggle btn btn-outline-metal m-btn  m-btn--icon m-btn--pill">
                                        <span>الوصول السريع</span>
                                    </a>
                                    <div class="m-dropdown__wrapper">
                                        <span class="m-dropdown__arrow m-dropdown__arrow--left m-dropdown__arrow--adjust"></span>
                                        <div class="m-dropdown__inner">
                                            <div class="m-dropdown__body">
                                                <div class="m-dropdown__content">
                                                    <ul class="m-nav">
                                                        <li class="m-nav__section m-nav__section--first m--hide">
                                                            <span class="m-nav__section-text">الوصول السريع</span>
                                                        </li>
                                                        <li class="m-nav__item">
                                                            <a href="~/Services" class="m-nav__link">
                                                                <i class="m-nav__link-icon flaticon-share"></i>
                                                                <span class="m-nav__link-text">ادارة الخدمات</span>
                                                            </a>
                                                        </li>
                                                        <li class="m-nav__item">
                                                            <a href="~/Coordinator" class="m-nav__link">
                                                                <i class="m-nav__link-icon flaticon-share"></i>
                                                                <span class="m-nav__link-text">ادارة المنسقين</span>
                                                            </a>
                                                        </li>
                                                        <li class="m-nav__item">
                                                            <a href="~/CoordinatorServices" class="m-nav__link">
                                                                <i class="m-nav__link-icon flaticon-share"></i>
                                                                <span class="m-nav__link-text">تنسيق خدمة</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <a href="javascript:;" id="m_aside_left_offcanvas_toggle" class="m-brand__icon m-brand__toggler m-brand__toggler--left m--visible-tablet-and-mobile-inline-block">
                                    <span></span>
                                </a>


                                <a id="m_aside_header_topbar_mobile_toggle" href="javascript:;" class="m-brand__icon m--visible-tablet-and-mobile-inline-block">
                                    <i class="flaticon-more"></i>
                                </a>


                            </div>
                        </div>
                    </div>

                    <!-- END: Brand -->
                    <div class="m-stack__item m-stack__item--fluid m-header-head" id="m_header_nav">

                        <!-- BEGIN: Topbar -->
                        <div id="m_header_topbar" class="m-topbar  m-stack m-stack--ver m-stack--general">
                            <div class="m-stack__item m-topbar__nav-wrapper">
                                <ul class="m-topbar__nav m-nav m-nav--inline">
                                    <li class="m-nav__item m-topbar__user-profile  m-dropdown m-dropdown--medium m-dropdown--arrow  m-dropdown--align-right m-dropdown--mobile-full-width m-dropdown--skin-light" m-dropdown-toggle="click">
                                        <a href="#" class="m-nav__link m-dropdown__toggle">
                                            <span class="m-topbar__userpic">
                                                <img src="~/Images/@ViewBag.AdminImageName" class="m--img-rounded m--marginless m--img-centered" alt="" />
                                            </span>
                                            <span class="m-nav__link-icon m-topbar__usericon  m--hide">
                                                <span class="m-nav__link-icon-wrapper"><i class="flaticon-user-ok"></i></span>
                                            </span>

                                        </a>

                                        <div class="m-dropdown__wrapper">
                                            <span class="m-dropdown__arrow m-dropdown__arrow--left m-dropdown__arrow--adjust"></span>
                                            <div class="m-dropdown__inner">
                                                <div class="m-dropdown__header m--align-center">
                                                    <div class="m-card-user m-card-user--skin-light">
                                                        <div class="m-card-user__pic">
                                                            <img src="~/Images/@ViewBag.AdminImageName" class="m--img-rounded m--marginless" alt="" />
                                                        </div>
                                                        <div class="m-card-user__details">
                                                            <span class="m-card-user__name m--font-weight-500">@ViewBag.AdminFullName</span>
                                                            <a href="" class="m-card-user__email m--font-weight-300 m-link">@ViewBag.AdminEmail</a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="m-dropdown__body">
                                                    <div class="m-dropdown__content">
                                                        <ul class="m-nav m-nav--skin-light">


                                                            <form style="display:none" id="signout" class="form-inline" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })"></form>

                                                            <li class="m-nav__item">
                                                                <a onclick="document.getElementById('signout').submit();" class="btn m-btn--pill    btn-secondary m-btn m-btn--custom m-btn--label-brand m-btn--bolder">تسجيل الخروج</a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>

                                </ul>
                            </div>
                        </div>

                        <!-- END: Topbar -->
                    </div>
                </div>
            </div>
        </header>

        <!-- END: Header -->
        <!-- begin::Body -->
        <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body" style="margin-top:-18px">

            <!-- BEGIN: Left Aside -->
            <button class="m-aside-left-close  m-aside-left-close--skin-light " id="m_aside_left_close_btn"><i class="la la-close"></i></button>
            <div id="m_aside_left" class="m-grid__item	m-aside-left  m-aside-left--skin-light ">
                <div id="m_ver_menu" class="m-aside-menu  m-aside-menu--skin-light m-aside-menu--submenu-skin-light " m-menu-vertical="1" m-menu-scrollable="0" m-menu-dropdown-timeout="500">
                    <ul class="m-menu__nav  m-menu__nav--dropdown-submenu-arrow ">
                        <li class="m-menu__item  m-menu__item--submenu" aria-haspopup="true" m-menu-submenu-toggle="hover">
                            <a href="javascript:;" class="m-menu__link m-menu__toggle">
                                <i class="m-menu__link-icon flaticon-users"></i><span class="m-menu__link-text">المستخدمين و المشرفين</span><i class="m-menu__ver-arrow la la-angle-right"></i>
                            </a>
                            <div class="m-menu__submenu ">
                                <span class="m-menu__arrow"></span>
                                <ul class="m-menu__subnav">
                                    <li class="m-menu__item  m-menu__item--parent" aria-haspopup="true"><span class="m-menu__link"><span class="m-menu__link-text"></span></span></li>
                                    <li class="m-menu__item " aria-haspopup="true"><a asp-controller="User" asp-action="Index" class="m-menu__link "><i class="m-menu__link-bullet m-menu__link-bullet--dot"><span></span></i><span class="m-menu__link-text">ادارة المستخدمين</span></a></li>
                                    <li class="m-menu__item " aria-haspopup="true" m-menu-link-redirect="1"><a asp-controller="User" asp-action="IndexAdmin" class="m-menu__link "><i class="m-menu__link-bullet m-menu__link-bullet--dot"><span></span></i><span class="m-menu__link-text">ادارة المشرفين</span></a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="m-menu__item " aria-haspopup="true" m-menu-link-redirect="1"><a asp-controller="Drugs" asp-action="Index" class="m-menu__link "><i class="m-menu__link-icon flaticon-lifebuoy"></i><span class="m-menu__link-text">الدواء</span></a></li>
                        <li class="m-menu__item " aria-haspopup="true" m-menu-link-redirect="1"><a asp-controller="Payments" asp-action="Index" class="m-menu__link "><i class="m-menu__link-icon flaticon-lifebuoy"></i><span class="m-menu__link-text">المبيعات</span></a></li>
                        <li class="m-menu__item " aria-haspopup="true" m-menu-link-redirect="1"><a asp-controller="Categories" asp-action="Index" class="m-menu__link "><i class="m-menu__link-icon flaticon-lifebuoy"></i><span class="m-menu__link-text">التصنيفات</span></a></li>

                    </ul>
                </div>
            </div>

            <div class="m-grid__item m-grid__item--fluid m-wrapper">
                <div class="m-content col-xs-push-12">
                    @RenderBody()
                </div>
            </div>
        </div>

        <footer class="m-grid__item		m-footer ">
            <div class="m-container m-container--fluid m-container--full-height m-page__container">
                <div class="m-stack m-stack--flex-tablet-and-mobile m-stack--ver m-stack--desktop">
                    <div class="m-stack__item m-stack__item--left m-stack__item--middle m-stack__item--last">
                        <span class="m-footer__copyright">
                            ل جميع الحقوق محفوظة . @DateTime.Now.Year &copy;
                        </span>
                    </div>

                </div>
            </div>
        </footer>

    </div>


    <div id="m_scroll_top" class="m-scroll-top">
        <i class="la la-arrow-up"></i>
    </div>


    <!--begin::Modal-->
    <div class="modal fade" id="PopUp" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">


                <div class="modal-header">
                    <h5 class="modal-title"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="Confirm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">تحذير</h5>
                </div>
                <div class="modal-body">
                    <p>هل انت متاكد من استمرار العملية ؟</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">الغاء الامر</button>
                    <button type="button" class="btn btn-danger">نعم</button>
                </div>
            </div>
        </div>
    </div>

    <script src="~/demo11/assets/vendors/base/vendors.bundle.js" type="text/javascript"></script>
    <script src="~/demo11/assets/demo/demo11/base/scripts.bundle.js" type="text/javascript"></script>

    <script src="~/metronic-datatable/base/data-json.js" type="text/javascript"></script>
    <script src="~/metronic-datatable/base/data-ajax.js" type="text/javascript"></script>

    <script src="~/metronic-datatable/basic.js" type="text/javascript"></script>

    <script src="~/metronic-datatable/datatables.bundle.js" type="text/javascript"></script>
    <script src="~/nprogress-master/nprogress.js"></script>

    <script>
        $(".ajaxForm").ajaxForm({
            success: function (json) {
                if (json.status == 1) {
                    var tname = $('.ajaxForm').attr("tname");
                    var fname = $('.ajaxForm').attr("fname");
                    if (tname != null) {
                        RefreshData(tname);
                    }
                    if (fname != null) {
                        eval(fname);
                    }
                    if (!$("#tblItems").hasClass("autohide")) {
                        $(".ajaxForm").resetForm();
                        $("#tblItems tbody tr").remove();
                        $("#tblItems").addClass("hidden").next().show();
                    }
                    else {
                        $(".select2").val('').change();
                    }
                }
                console.log(json.close);
                if (json.msg != null)
                    ShowMessage(json.msg);
                if (json.redirect != null)
                    window.location = json.redirect;
                if (json.close == 1)
                    $("#PopUp").modal("hide");
                $(".ajaxForm :submit").prop("disabled", false);
            },
            beforeSubmit: function () {
                $(".ajaxForm :submit").prop("disabled", true);
            }
        });

        $(document).on("click", ".PopUp", function () {
            $("#PopUp").modal("show");
            $("#PopUp .modal-body").html('<h3 class="text-center text-danger"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></h3>');
            $("#PopUp .modal-body").load($(this).attr("href"), function () {
                setTimeout(function () { $("#PopUp [autofocus]").focus().select(); }, 500);
            });
            $("#PopUp .modal-title").text($(this).attr("title"));
            return false;
        });

        $(document).on("click", ".Confirm", function () {
            $("#Confirm").modal("show");
            $("#Confirm .btn-danger").attr("href", $(this).attr("href"));
            $("#Confirm .btn-danger").attr("tname", $(this).attr("tname"));
            return false;
        });

        $("#Confirm .btn-danger").click(function () {
            var tname = $(this).attr("tname");
            var fname = $('.ajaxForm').attr("fname");
            var url = $(this).attr("href");
            $.ajax({
                url: url,
                success: function (json) {
                    if (json.status == 1) {
                        if (tname != null) {
                            RefreshData(tname);
                        }
                        if (fname != null) {
                            eval(fname);
                        }
                    }
                    ShowMessage(json.msg);
                }
            });
            $("#Confirm").modal("hide");
            return false;
        });

        function RefreshData(tn) {
            var xtable = $(tn).dataTable();
            var info = $(tn).DataTable().page.info();
            xtable.fnDraw();
            xtable.fnPageChange(info.page);
        }

        $(document).ajaxStart(function () {
            $(".wait").text("Wait...");
            NProgress.start();
        });
        $(document).ajaxStop(function () {
            $(".wait").text("");
            NProgress.done();
        });
        $(document).ajaxError(function () {
            $(".wait").text("");
            NProgress.done();
            $(".ajaxForm :submit").prop("disabled", false);
        });

       toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": false,
            "progressBar": false,
            "positionClass": "toast-bottom-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        function ShowMessage(msg) {
            var cls = "info";
            if (msg.indexOf("s:") == 0) { cls = "success"; msg = msg.substring(2); }
            if (msg.indexOf("w:") == 0) { cls = "warning"; msg = msg.substring(2); }
            if (msg.indexOf("e:") == 0) { cls = "error"; msg = msg.substring(2); }
            if (msg.indexOf("i:") == 0) { cls = "info"; msg = msg.substring(2); }
            toastr[cls](msg, "@ViewBag.Title");
        }

        function PageLoadActions() {
            $(".date").datepicker({ format: "dd/mm/yyyy", endDate: "+0d", autoclose: true });
            $(".input-daterange").datepicker({ format: "dd/mm/yyyy", endDate: "+0d", autoclose: true });
            $(".ajaxForm").ajaxForm({
                success: function (json) {
                    if (json.status == 1) {

                        var tname = $('.ajaxForm').attr("tname");
                        var fname = $('.ajaxForm').attr("fname");

                        if (tname != null) {
                            RefreshData(tname);
                        }
                        if (fname != null) {
                            eval(fname);
                        }
                        if (!$("#tblItems").hasClass("autohide")) {
                            $(".ajaxForm").resetForm();
                            $("#tblItems tbody tr").remove();
                            $("#tblItems").addClass("hidden").next().show();
                        }
                        else {
                            $(".select2").val('').change();
                        }
                    }
                    console.log(json.close);
                    if (json.msg != null)
                        ShowMessage(json.msg);
                    if (json.redirect != null)
                        window.location = json.redirect;
                    if (json.close == 1)
                        $("#PopUp").modal("hide");
                    $(".ajaxForm :submit").prop("disabled", false);
                },
                beforeSubmit: function () {
                    $(".ajaxForm :submit").prop("disabled", true);
                }
            });
        }


    </script>




    @RenderSection("scripts", false)
</body>

</html>